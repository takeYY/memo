# Chapter.02: Amazon EC2

{docsify-updated}

###### tags: `.AWS`, `.Introduction`, `.Book`, `.Tech`

---

## 2.1: EC2 の特徴

- N/A

## 2.2: AMI

- AMI (Amazon Machine Image)
  - インスタンス構築の設計図

## 2.3: ユーザーデータ

- ユーザーデータ
  - インスタンス初回起動時に実行されるテキストデータ
  - 方法
    - シェルスクリプト
    - cloud-init
- ゴールデンイメージ方式
  - 全ての設定が済んだ AMI から起動する方法
  - 今後、設定を変更する可能性が`低い`場合に有用
- ユーザーデータ方式
  - 空のインスタンスを起動後、ユーザーデータを用いて設定を行う方法
  - 今後、設定を変更する可能性が`高い`場合に有用

## 2.4: インスタンスメタデータ

- インスタンスメタデータ
  - インスタンス内部からのみアクセス可能なインスタンスに関するデータ

## 2.5: インスタンスタイプ

- N/A

## 2.6: EBS

- EBS (Elastic Block Store)
  - インスタンスにアタッチして利用するブロックストレージサービス
  - windows explorer や Finder で閲覧できるような階層構造を持つデータ
  - FHS (Filesystem Hierarchy Standard) 3.0
    - Linux 系 OS のディレクトリ構成標準規格
- スナップショット
  - EBS でスナップショットを作成することで S3 にバックアップできる (増分バックアップのみ)
  - フルバックアップ
    - 全てのデータを完全に複製する方式
  - 差分バックアップ
    - 最新のフルバックアップ以降の全ての変更を毎回複製する方式
  - 増分バックアップ
    - 前回のバックアップからの差分のみを複製する方式
- クラスタリング
  - 複数台のサーバを連結し、1 つのサーバのように振る舞う技術
  - フェイルオーバークラスタ
    - 稼働中のノードが停止した場合に待機系のノードに処理を引き継がせる
  - 負荷分散クラスタ
    - ロードバランサでリクエストを各サーバに振り分ける
- ブロックストレージ
  - ストレージ -> ボリューム -> ブロックに分割してデータを管理する
  - 低遅延が求められるデータベースシステム、業務システムで利用される
- ファイルストレージ
  - ファイル形式でデータを管理する
  - 階層的なので直感的に運用可能
  - ブロックストレージに比べると、処理速度は劣る
- オブジェクトストレージ
  - 非構造化データ(ドキュメント, 画像, 音声)をオブジェクトとして扱いデータを管理する
  - データアクセスは最も遅い
  - REST API からアクセス
  - 容量の拡張性は高い
  - アプリケーションログなど更新頻度の低い大容量データの保管目的で利用

## 2.7: EFS

- EFS (Elastic File System)
  - フルマネージド型のネットワークファイルストレージサービス
  - オンプレの NAS に相当するサービス
  - 複数インスタンスからの同時アクセスに対応
- ストレージクラス
  - 標準ストレージクラス
    - 複数の AZ に冗長化して保存
  - 標準\_低頻度アクセスストレージクラス
    - 複数の AZ に冗長化して保存
  - 1 ゾーンストレージクラス
    - 1 つの AZ に保存
    - 標準より安価で利用可能
    - ファイルの読み書き毎に課金
  - 1 ゾーン低頻度アクセスストレージクラス
    - 1 つの AZ に保存
    - 標準より安価で利用可能
    - ファイルの読み書き毎に課金

## 2.8: FSx

- サードパーティ製のファイルシステムを提供するフルマネージド型のサービス
- EFS とは異なり、SMB プロトコルもサポートしている
- Amazon FSx for Windows File Server
- Amazon FSx for Lustre

## 2.9: Systems Manager

- AWS リソースやオンプレのインフラストラクチャを管理・制御するためのサービス
- 実現できること
  - リソース状況の可視化
  - 提携作業の実施・自動化
  - アプリの設定管理
- 機能タイプ
  - 高速セットアップ
  - 運用管理
    - Incident Manager
  - アプリ管理
  - 変更管理
  - ノード管理
    - Session Manager
  - 共有リソース

## 2.10: キーペア

- 共通鍵暗号方式の問題点
  - 鍵配送問題
- 公開鍵暗号方式の仕組み
- 暗号アルゴリズム
  - 共通鍵暗号方式
    - 代表的なアルゴリズム
      - AES
    - 暗号化と複合化の処理が軽い
    - 無線 LAN のハイブリッド暗号で今でも使われている
      - 公開鍵暗号で共通鍵をやりとりし、処理自体は共通鍵暗号でデータを暗号化し処理を高速化
  - 公開鍵暗号方式
    - 代表的なアルゴリズム
      - RSA
    - デジタル署名で応用される

## 2.11: 購入方法

- オンデマンドインスタンス
  - デフォルトで適用される購入方法
  - 従量課金
- リザーブドインスタンス
  - スペックやリージョンを 1 or 3 年変更しないことを前提に割引価格で購入する方法
  - 割引率は以下支払い方法により変わる
    - 全て前払い
    - 一部前払い
    - 前払いなし
- スポットインスタンス
  - AWS の余ったインスタンスを利用する購入方法
  - AWS 側のリソースの余り具合によって変動する「スポット価格」
  - オンデマンドに比べて最大 90%安くなる
  - デメリット
    - 入札価格よりもスポット価格が上回った場合は、インスタンスが終了する
    - -> 処理が途中で終了しても問題ないアプリ仕様が求められる
